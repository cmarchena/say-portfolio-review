<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scoring</title>
    <style>
        form {
            display: flex;
            flex-wrap: wrap;
            max-width: 52%;
        }

        .form-group {
            display: block;
            width: 35%;
            margin-bottom: 1rem;
        }

        button {
            display: block;
        }
    </style>
</head>

<body>
    <h1>Scoring</h1>
    <form>
        <div class="form-group">

            <label for="requirements">Requirements</label>
            <input type="number" name="requirements" id="requirements" min="0" max="100">
        </div>
        <div class="form-group">

            <label for="coding-standards">Coding Standards</label>
            <select name="coding-standards" id="coding-standards">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
            </select>
        </div>
        <div class="form-group">

            <label for="documentation">Documentation</label>
            <select name="documentation" id="documentation">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
            </select>
        </div>
        <div class="form-group">

            <label for="runtime">Runtime</label>
            <select name="runtime" id="runtime">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
            </select>
        </div>
        <div class="form-group">

            <label for="efficiency">Efficiency</label>
            <select name="efficiency" id="efficiency">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
            </select>
        </div>
    </form>
    <button id="submit">Submit</button>
    <p id="result"></p>
    <script>

        /* START CONSTANTS */
        // weights has data type object and defines the contribution of each section to the whole 
        const weights = {
            "requirements": 5,
            "coding": 2,
            "documentation": 0.5,
            "runtime": 2,
            "efficiency": 0.5
        }
        /* END CONSTANTS */
        /* START FUNCTIONS */
        /**
         * Transform the score generated by the automatic testing into a performance level
         * - if below 70% = 1
         * - if between 70-80% = 2
         * - if between 80-90% = 3
         * - if between 90-100% = 4
         * @param {number} autotestScore - score generate by the automatic testing (runTests.js)
         * @returns {number} - A number from 1 to 4 representing the equivalent preformance level 
        */
        function transformRequirements(autotestScore) {
            if (autotestScore < 70) {
                return 1
            }
            if (autotestScore >= 70 && autotestScore < 80) {
                return 2
            }
            if (autotestScore >= 80 && autotestScore < 90) {
                return 3
            }
            if (autotestScore >= 90) {
                return 4
            }
        }
        /**
         * Calculates a total score by reducing an array of scores
         * @param {number[]} scores - An array of numeric scores
         * @returns {number} - The total calculated score 
        */

        function calculateScore(scores) {
            /**
             * Reduces the scores array to a single total
             * @param {number} curr - The running total
             * @param {number} prev - The current score being processed
             * @param {number} index - The index of the current score
             * @returns {number} - The updated running total 
            */
            return scores.reduce((curr, prev, index) => {
                return curr + prev * weights[Object.keys(weights)[index]]
            }, 0)
        }

        /**
        * Calculates the performance based on the result and the maximum possible score.
        *
        * @param {number} result - The actual score.
        * @param {number} max - The maximum possible score.
        * @returns {string} The performance level:
        * - 'Needs improvement' if the result is less than 40% of the max.
        * - 'Acceptable' if the result is between 40% and 80% of the max.
        * - 'Proficient' if the result is between 80% and 100% of the max (excluding 100%).
        * - 'Excellent' if the result is equal to the max.
        */
        function calculatePerformance(result, max) {
            if (result < max * 0.4) {
                return 'Needs improvement'
            }
            if (result >= max * 0.4 && result < max * 0.8) {
                return 'Acceptable'
            }
            if (result >= max * 0.8 && result < max) {
                return 'Proficient'
            }
            if (result === max) {
                return 'Excellent'
            }
        }
        /* END FUNCTIONS */
        const buttonEl = document.getElementById("submit")
        buttonEl.addEventListener("click", () => {
            const scores = []
            const resultEl = document.getElementById("result")
            const requirementsEl = document.getElementById("requirements");
            const requirementsScore = requirementsEl.value
            if (requirementsScore < 0 || requirementsScore > 100) {
                resultEl.innerHTML = "Requirements score must be a number between 0 and 100. Try again"
            } else {
                scores.push(transformRequirements(Number(requirementsScore)))
                const codingEl = document.getElementById("coding-standards");
                const codingScore = codingEl.options[codingEl.selectedIndex].value;
                scores.push(Number(codingScore))
                const documentationEl = document.getElementById("documentation");
                const documentationScore = documentationEl.options[documentationEl.selectedIndex].value;
                scores.push(Number(documentationScore))
                const runtimeEl = document.getElementById("runtime");
                const runtimeScore = runtimeEl.options[runtimeEl.selectedIndex].value;
                scores.push(Number(runtimeScore))
                const efficiencyEl = document.getElementById("efficiency");
                const efficiencyScore = efficiencyEl.options[efficiencyEl.selectedIndex].value;
                scores.push(Number(efficiencyScore))
                const finalScore = calculateScore(scores)
                resultEl.innerHTML = `Student score is ${finalScore.toFixed(2)}, performance level: ${calculatePerformance(finalScore, 40)}`
            }
        })
    </script>
</body>

</html>